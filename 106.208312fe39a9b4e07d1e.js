"use strict";(self.webpackChunkproduction_project=self.webpackChunkproduction_project||[]).push([[106],{4331:function(e,a,t){t.r(a),t.d(a,{default:function(){return Q}});var s=t(2327),r=t(7294),i=t(9250),n=t(8231),c=t(3007),d=t(1233),l=t(6160),o=t(2047),m=t(1715);const x=t(6628).p.injectEndpoints({endpoints:e=>({getArticleRecommendationsList:e.query({query:e=>({url:"/articles",params:{_limit:e}})})})}).useGetArticleRecommendationsListQuery;var u=t(5893);const g=(0,r.memo)((e=>{const{className:a}=e,{t:t}=(0,s.$)(),{isLoading:r,data:i,error:d}=x(3);return r||d||!i?null:(0,u.jsxs)(o.g,{gap:"8",className:(0,c.A)("",{},[a]),children:[(0,u.jsx)(m.xv,{size:m.yH.L,title:t("Рекомендуем")}),(0,u.jsx)(n.wD,{articles:i,target:"_blank"})]})}));var h=t(743);const j=(0,r.lazy)((()=>t.e(77).then(t.bind(t,8077))));var p=t(2949),v=t(3312),C=t(6897),L=t(5693),N={CommentCard:"xIHByGcu",header:"dsH_3Oqu",username:"dw82WMzO",loading:"V0iZ1Un3"};const f=(0,r.memo)((e=>{const{className:a,comment:t,isLoading:r}=e,{t:i}=(0,s.$)();return r?(0,u.jsxs)(o.g,{gap:"8",max:!0,className:(0,c.A)(N.CommentCard,{},[a,N.loading]),children:[(0,u.jsxs)("div",{className:N.header,children:[(0,u.jsx)(v.O,{width:30,height:30,border:"50%"}),(0,u.jsx)(v.O,{height:16,width:100})]}),(0,u.jsx)(v.O,{className:N.text,width:"100%",height:50})]}):t?(0,u.jsxs)(o.g,{gap:"8",max:!0,className:(0,c.A)(N.CommentCard,{},[a]),children:[(0,u.jsxs)(C.F,{to:`${L.h3.profile}${t.user.id}`,className:N.header,children:[t.user.avatar?(0,u.jsx)(p.q,{size:30,src:t.user.avatar}):null,(0,u.jsx)(m.xv,{className:N.username,title:t.user.username})]}),(0,u.jsx)(m.xv,{className:N.text,text:t.text})]}):null})),w=(0,r.memo)((e=>{const{className:a,comments:t,isLoading:r}=e,{t:i}=(0,s.$)();return r?(0,u.jsxs)(o.g,{gap:"16",max:!0,className:(0,c.A)("",{},[a]),children:[(0,u.jsx)(f,{isLoading:!0}),(0,u.jsx)(f,{isLoading:!0}),(0,u.jsx)(f,{isLoading:!0})]}):(0,u.jsx)(o.g,{gap:"16",max:!0,className:(0,c.A)("",{},[a]),children:t?.length?t.map((e=>(0,u.jsx)(f,{isLoading:r,comment:e},e.id))):(0,u.jsx)(m.xv,{text:i("Комментарии отсутствуют")})})}));var y=t(5401),A=t(9970),I=t(379),S=t(4268);const b=(0,S.hg)("ArticleDetailsPage/fetchCommentsByArticleId",(async(e,a)=>{const{extra:t,rejectWithValue:s}=a;try{if(!e)return s("error");const a=await t.api.get("/comments",{params:{articleId:e,_expand:"user"}});if(!a.data)throw new Error;return a.data}catch(e){return s("error")}})),D=(0,S.HF)({selectId:e=>e.id}),k=D.getSelectors((e=>e.articleDetailsPage?.comments||D.getInitialState())),$=(0,S.oM)({name:"articleDetailsCommentsSlice",initialState:D.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(b.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(b.fulfilled,((e,a)=>{e.isLoading=!1,D.setAll(e,a.payload)})).addCase(b.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload}))}}),{reducer:P}=$,_=e=>e.articleDetailsPage?.comments?.isLoading;var O=t(4420),q=t(3918);const z=(0,S.hg)("articleDetails/addCommentForArticle",(async(e,a)=>{const{extra:t,dispatch:s,rejectWithValue:r,getState:i}=a,n=(0,O.m5)(i()),c=(0,q.wq)(i());if(!n||!e||!c)return r("no-data");try{const a=await t.api.post("/comments",{articleId:c.id,userId:n.id,text:e});if(!a.data)throw new Error;return s(b(c.id)),a.data}catch(e){return r("error")}})),U=(0,r.memo)((e=>{const{className:a,id:t}=e,{t:i}=(0,s.$)(),n=(0,y.T)(),d=(0,h.v9)(k.selectAll),l=(0,h.v9)(_),x=(0,r.useCallback)((e=>{n(z(e))}),[n]);return(0,A.Q)((()=>{n(b(t))})),(0,u.jsxs)(o.g,{gap:"16",max:!0,className:(0,c.A)("",{},[a]),children:[(0,u.jsx)(m.xv,{size:m.yH.L,title:i("Комментарии")}),(0,u.jsx)(r.Suspense,{fallback:(0,u.jsx)(I.a,{}),children:(0,u.jsx)(j,{onSendComment:x})}),(0,u.jsx)(w,{isLoading:l,comments:d})]})}));var E=t(5255);const H=(0,t(2222).P1)(n.wq,O.m5,((e,a)=>!(!e||!a)&&e.user.id===a.id)),R=(0,r.memo)((e=>{const{className:a}=e,{t:t}=(0,s.$)(),d=(0,i.s0)(),l=(0,h.v9)(H),m=(0,h.v9)(n.wq),x=(0,r.useCallback)((()=>{d(L.h3.articles)}),[d]),g=(0,r.useCallback)((()=>{d(`${L.h3.article_details}${m?.id}/edit`)}),[m?.id,d]);return(0,u.jsxs)(o.U,{max:!0,justify:"between",className:(0,c.A)("",{},[a]),children:[(0,u.jsx)(E.zx,{theme:E.bn.OUTLINE,onClick:x,children:t("Назад к списку")}),l&&(0,u.jsx)(E.zx,{theme:E.bn.OUTLINE,onClick:g,children:t("Редактировать")})]})}));var W=t(7779);const F=(0,S.hg)("ArticleDetailsPage/fetchArticleRecommendations",(async(e,a)=>{const{rejectWithValue:t,extra:s}=a;try{const e=await s.api.get("/articles",{params:{_limit:4,_expand:"user"}});if(!e.data)throw new Error;return e.data}catch(e){return t("error")}})),T=(0,S.HF)({selectId:e=>e.id}),V=(T.getSelectors((e=>e.articleDetailsPage?.recommendations||T.getInitialState())),(0,S.oM)({name:"articleDetailsPageRecommendationsSlice",initialState:T.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(F.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(F.fulfilled,((e,a)=>{e.isLoading=!1,T.setAll(e,a.payload)})).addCase(F.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload}))}})),{reducer:M}=V,B={articleDetailsPage:(0,W.UY)({recommendations:M,comments:P})},G=e=>{const{className:a}=e,{t:t}=(0,s.$)("article-details"),{id:r}=(0,i.UO)();return(0,u.jsx)(d.W,{reducers:B,removeAfterUnmount:!0,children:(0,u.jsx)(l.T,{className:(0,c.A)("",{},[a]),children:(0,u.jsxs)(o.g,{gap:"16",max:!0,children:[(0,u.jsx)(R,{}),(0,u.jsx)(n.D0,{id:r}),(0,u.jsx)(g,{}),(0,u.jsx)(U,{id:r})]})})})};G.displayName="ArticleDetailsPage";var Q=(0,r.memo)(G)}}]);