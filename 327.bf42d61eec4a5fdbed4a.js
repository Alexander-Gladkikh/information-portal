"use strict";(self.webpackChunkproduction_project=self.webpackChunkproduction_project||[]).push([[327],{1327:function(e,a,r){r.r(a),r.d(a,{default:function(){return q}});var n=r(7294),t=r(9250),l=r(3007),s=r(6160),o=r(3363),i=r(4092),c=r(2327),d=r(743),u=r(5401),C=r(9970),m=r(1715),h=r(8312),f=r(379),g=r(2949);let p=function(e){return e.RUB="RUB",e.EUR="EUR",e.USD="USD",e}({});var R=r(4342),v=r(5893);const x=[{value:p.RUB,content:p.RUB},{value:p.EUR,content:p.EUR},{value:p.USD,content:p.USD}],y=(0,n.memo)((e=>{let{className:a,value:r,onChange:t,readonly:l}=e;const{t:s}=(0,c.$)(),o=(0,n.useCallback)((e=>{t?.(e)}),[t]);return(0,v.jsx)(R.w,{className:a,value:r,defaultValue:s("Укажите валюту"),label:s("Укажите валюту"),items:x,onChange:o,readonly:l,direction:"top right"})}));let E=function(e){return e.Russia="Russia",e.Belarus="Belarus",e.Kazakhstan="Kazakhstan",e.Arminia="Arminia",e}({});const N=[{value:E.Arminia,content:E.Arminia},{value:E.Russia,content:E.Russia},{value:E.Belarus,content:E.Belarus},{value:E.Kazakhstan,content:E.Kazakhstan}],j=(0,n.memo)((e=>{let{className:a,value:r,onChange:t,readonly:l}=e;const{t:s}=(0,c.$)(),o=(0,n.useCallback)((e=>{t?.(e)}),[t]);return(0,v.jsx)(R.w,{className:a,onChange:o,value:r,defaultValue:s("Укажите страну"),label:s("Укажите страну"),items:N,readonly:l,direction:"top right"})}));var A={ProfileCard:"wW9jgKKD",loading:"t07ZxFGs",error:"i5YK3SSb",editing:"DjTe7269"};const T=(0,n.memo)((e=>{const{className:a,data:r,error:n,isLoading:t,onChangeLastname:s,onChangeFirstname:d,onChangeCity:u,onChangeAge:C,onChangeAvatar:p,onChangeUsername:R,onChangeCurrency:x,onChangeCountry:E,readonly:N}=e,{t:T}=(0,c.$)("profile");if(t)return(0,v.jsx)(o.U,{justify:"center",max:!0,className:(0,l.A)(A.ProfileCard,{[A.loading]:!0},[a]),children:(0,v.jsx)(f.a,{})});if(n)return(0,v.jsx)(o.U,{justify:"center",max:!0,className:(0,l.A)(A.ProfileCard,{},[a,A.error]),children:(0,v.jsx)(m.xv,{theme:m.lg.ERROR,title:T("Произошла ошибка при загрузке профиля"),text:T("Попробуйте перезагрузить страницу"),align:m.PH.CENTER})});const O={[A.editing]:!N};return(0,v.jsx)(i.g,{gap:"32",max:!0,className:(0,l.A)(A.ProfileCard,O,[a]),children:(0,v.jsxs)("div",{className:A.data,children:[r?.avatar&&(0,v.jsx)(o.U,{justify:"center",max:!0,className:A.avatarWrapper,children:(0,v.jsx)(g.q,{src:r?.avatar})}),(0,v.jsx)(h.I,{value:r?.first,placeholder:T("Ваше имя"),className:A.input,onChange:d,readonly:N}),(0,v.jsx)(h.I,{value:r?.lastname,placeholder:T("Ваше Фамилия"),className:A.input,onChange:s,readonly:N}),(0,v.jsx)(h.I,{value:r?.age,placeholder:T("Ваше возраст"),className:A.input,onChange:C,readonly:N}),(0,v.jsx)(h.I,{value:r?.city,placeholder:T("Город"),className:A.input,onChange:u,readonly:N}),(0,v.jsx)(h.I,{value:r?.username,placeholder:T("Введите имя пользователя"),className:A.input,onChange:R,readonly:N}),(0,v.jsx)(h.I,{value:r?.avatar,placeholder:T("Введите ссылку на аватар"),className:A.input,onChange:p,readonly:N}),(0,v.jsx)(y,{className:A.input,value:r?.currency,onChange:x,readonly:N}),(0,v.jsx)(j,{className:A.input,value:r?.country,onChange:E,readonly:N})]})})}));var O=r(1233),U=r(2047);let _=function(e){return e.INCORRECT_USER_DATA="INCORRECT_USER_DATA",e.INCORRECT_AGE="INCORRECT_AGE",e.INCORRECT_COUNTRY="INCORRECT_COUNTRY",e.NO_DATA="NO_DATA",e.SERVER_ERROR="SERVER_ERROR",e}({});var b=r(4420),I=r(5255);const k=e=>e.profile?.data,P=e=>e.profile?.readonly;var S=r(4268);const D=e=>e.profile?.form,L=(0,S.hg)("profile/updateProfileData",(async(e,a)=>{const{extra:r,rejectWithValue:n,getState:t}=a,l=D(t()),s=(e=>{if(!e)return[_.NO_DATA];const{first:a,lastname:r,age:n,country:t}=e,l=[];return a&&r||l.push(_.INCORRECT_USER_DATA),n&&Number.isInteger(n)||l.push(_.INCORRECT_AGE),t||l.push(_.INCORRECT_COUNTRY),l})(l);if(s.length)return n(s);try{const e=await r.api.put(`/profile/${l?.id}`,l);if(!e.data)throw new Error;return e.data}catch(e){return console.log(e),n([_.SERVER_ERROR])}})),w=(0,S.hg)("profile/fetchProfileData",(async(e,a)=>{const{extra:r,rejectWithValue:n}=a;try{const a=await r.api.get(`/profile/${e}`);if(!a.data)throw new Error;return a.data}catch(e){return console.log(e),n("error")}})),B=(0,S.oM)({name:"profile",initialState:{readonly:!0,isLoading:!1,error:void 0,data:void 0},reducers:{setReadonly:(e,a)=>{e.readonly=a.payload},cancelEdit:e=>{e.readonly=!0,e.validateErrors=void 0,e.form=e.data},updateProfile:(e,a)=>{e.form={...e.data,...a.payload}}},extraReducers:e=>{e.addCase(w.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(w.fulfilled,((e,a)=>{e.isLoading=!1,e.data=a.payload,e.form=a.payload})).addCase(w.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload})).addCase(L.pending,(e=>{e.validateErrors=void 0,e.isLoading=!0})).addCase(L.fulfilled,((e,a)=>{e.isLoading=!1,e.data=a.payload,e.form=a.payload,e.readonly=!0,e.validateErrors=void 0})).addCase(L.rejected,((e,a)=>{e.isLoading=!1,e.validateErrors=a.payload}))}}),{actions:$}=B,{reducer:V}=B,F=(0,n.memo)((e=>{const{className:a}=e,{t:r}=(0,c.$)("profile"),t=(0,d.v9)(b.m5),s=(0,d.v9)(k),o=t?.id===s?.id,i=(0,d.v9)(P),C=(0,u.T)(),h=(0,n.useCallback)((()=>{C($.setReadonly(!1))}),[C]),f=(0,n.useCallback)((()=>{C($.cancelEdit())}),[C]),g=(0,n.useCallback)((()=>{C(L())}),[C]);return(0,v.jsxs)(U.U,{max:!0,justify:"between",className:(0,l.A)("",{},[a]),children:[(0,v.jsx)(m.xv,{title:r("Профиль")}),o&&(0,v.jsx)("div",{children:i?(0,v.jsx)(I.zx,{theme:I.bn.OUTLINE,onClick:h,children:r("Редактировать")}):(0,v.jsxs)(U.U,{gap:"8",children:[(0,v.jsx)(I.zx,{theme:I.bn.OUTLINE_RED,onClick:f,children:r("Отменить")}),(0,v.jsx)(I.zx,{theme:I.bn.OUTLINE,onClick:g,children:r("Сохранить")})]})})]})})),W=e=>e.profile?.error,z=e=>e.profile?.validateErrors,G=e=>e.profile?.isLoading;var K={};const M={profile:V},Y=(0,n.memo)((e=>{const{className:a,id:r}=e,{t:t}=(0,c.$)("profile"),s=(0,u.T)(),o=(0,d.v9)(D),i=(0,d.v9)(W),h=(0,d.v9)(G),f=(0,d.v9)(P),g=(0,d.v9)(z),p={[_.SERVER_ERROR]:t("Серверная ошибка при сохранении"),[_.INCORRECT_COUNTRY]:t("Некорректный регион"),[_.NO_DATA]:t("Данные не указаны"),[_.INCORRECT_USER_DATA]:t("Имя и фамилия обязательны"),[_.INCORRECT_AGE]:t("Некорректный возраст")};(0,C.Q)((()=>{r&&s(w(r))}));const R=(0,n.useCallback)((e=>{s($.updateProfile({first:e||""}))}),[s]),x=(0,n.useCallback)((e=>{s($.updateProfile({lastname:e||""}))}),[s]),y=(0,n.useCallback)((e=>{s($.updateProfile({city:e||""}))}),[s]),E=(0,n.useCallback)((e=>{s($.updateProfile({age:Number(e||0)}))}),[s]),N=(0,n.useCallback)((e=>{s($.updateProfile({username:e||""}))}),[s]),j=(0,n.useCallback)((e=>{s($.updateProfile({avatar:e||""}))}),[s]),A=(0,n.useCallback)((e=>{s($.updateProfile({currency:e}))}),[s]),b=(0,n.useCallback)((e=>{s($.updateProfile({country:e}))}),[s]);return(0,v.jsx)(O.W,{reducers:M,children:(0,v.jsxs)(U.g,{gap:"8",max:!0,className:(0,l.A)(K.EditableProfileCard,{},[a]),children:[(0,v.jsx)(F,{}),g?.length&&g.map((e=>(0,v.jsx)(m.xv,{theme:m.lg.ERROR,text:p[e]},e))),(0,v.jsx)(T,{data:o,isLoading:h,error:i,readonly:f,onChangeFirstname:R,onChangeLastname:x,onChangeAge:E,onChangeCity:y,onChangeUsername:N,onChangeAvatar:j,onChangeCurrency:A,onChangeCountry:b})]})})})),Q=e=>{let{className:a}=e;const{id:r}=(0,t.UO)();return(0,v.jsx)(o.U,{max:!0,justify:"end",children:(0,v.jsx)(s.T,{className:(0,l.A)("",{},[a]),children:(0,v.jsx)(i.g,{gap:"16",max:!0,children:(0,v.jsx)(Y,{id:r})})})})};Q.displayName="ProfilePage";var q=(0,n.memo)(Q)},1233:function(e,a,r){r.d(a,{W:function(){return s}});var n=r(7294),t=r(743),l=r(5893);const s=e=>{const{children:a,reducers:r,removeAfterUnmount:s=!0}=e,o=(0,t.oR)(),i=(0,t.I0)();return(0,n.useEffect)((()=>{const e=o.reducerManager.getMountedReducers();return Object.entries(r).forEach((a=>{let[r,n]=a;e[r]||(o.reducerManager.add(r,n),i({type:`@INIT ${r} reducer`}))})),()=>{s&&Object.entries(r).forEach((e=>{let[a,r]=e;o.reducerManager.remove(a),i({type:`@DESTROY ${a} reducer`})}))}}),[]),(0,l.jsx)(l.Fragment,{children:a})}},8312:function(e,a,r){r.d(a,{I:function(){return s}});var n=r(7294),t=r(3007),l=r(5893);const s=(0,n.memo)((e=>{const{className:a,value:r,onChange:s,type:o="text",placeholder:i,autofocus:c,readonly:d,...u}=e,C=(0,n.useRef)(null),[m,h]=(0,n.useState)(!1),[f,g]=(0,n.useState)(0),p=m&&!d;(0,n.useEffect)((()=>{c&&(h(!0),C.current?.focus())}),[c]);const R={fTN1PnWu:d};return(0,l.jsxs)("div",{className:(0,t.A)("LuFDUWoP",R,[a]),children:[i&&(0,l.jsx)("div",{className:"emAQQ85i",children:`${i}>`}),(0,l.jsxs)("div",{className:"y1GiFC_L",children:[(0,l.jsx)("input",{ref:C,type:o,value:r,onChange:e=>{s?.(e.target.value),g(e.target.value.length)},className:"LVdIPwcx",onFocus:()=>{h(!0)},onBlur:()=>{h(!1)},onSelect:e=>{g(e?.target?.selectionStart||0)},readOnly:d,...u}),p&&(0,l.jsx)("span",{className:"lqMFGBuL",style:{left:9*f+"px"}})]})]})}))}}]);