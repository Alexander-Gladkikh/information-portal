"use strict";(self.webpackChunkproduction_project=self.webpackChunkproduction_project||[]).push([[426],{1668:function(e,a,t){t.r(a),t.d(a,{default:function(){return F}});var s=t(7294),r=t(9655),c=t(3007),l=t(1233),i=t(5401),o=t(9970),n=t(6160),d=t(2327),g=t(743),u=t(8231),p=t(1715),h=t(4268),v=t(1283);const m=e=>e.articlesPage?.isLoading||!1,y=e=>e.articlesPage?.error,P=e=>e.articlesPage?.view||u.GA.SMALL,f=e=>e.articlesPage?.page||1,S=e=>e.articlesPage?.order??"asc",x=e=>e.articlesPage?.sort??u.$B.CREATED,A=e=>e.articlesPage?.search??"",j=e=>e.articlesPage?.type??u.Iq.ALL,L=(0,h.hg)("ArticlesPage/fetchArticleList",(async(e,a)=>{const{extra:t,rejectWithValue:s,getState:r}=a,c=(l=r(),l.articlesPage?.limit||9);var l;const i=x(r()),o=S(r()),n=A(r()),d=f(r()),g=j(r());try{p={sort:i,order:o,search:n,type:g},window.history.pushState(null,"",function(e){const a=new URLSearchParams(window.location.search);return Object.entries(e).forEach((e=>{let[t,s]=e;void 0!==s&&a.set(t,s)})),`?${a.toString()}`}(p));const e=await t.api.get("/articles",{params:{_expand:"user",_limit:c,_page:d,_sort:i,_order:o,q:n,type:g===u.Iq.ALL?void 0:g}});if(!e.data)throw new Error;return e.data}catch(e){return s("error")}var p})),C=(0,h.HF)({selectId:e=>e.id}),w=C.getSelectors((e=>e.articlesPage||C.getInitialState())),N=(0,h.oM)({name:"articlesPageSlice",initialState:C.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{},view:u.GA.SMALL,page:1,hasMore:!0,_inited:!1,limit:9,sort:u.$B.CREATED,search:"",order:"asc",type:u.Iq.ALL}),reducers:{setView:(e,a)=>{e.view=a.payload,localStorage.setItem(v.f,a.payload)},setPage:(e,a)=>{e.page=a.payload},setOrder:(e,a)=>{e.order=a.payload},setSort:(e,a)=>{e.sort=a.payload},setType:(e,a)=>{e.type=a.payload},setSearch:(e,a)=>{e.search=a.payload},initState:e=>{const a=localStorage.getItem(v.f);e.view=a,e.limit=a===u.GA.BIG?4:9,e._inited=!0}},extraReducers:e=>{e.addCase(L.pending,((e,a)=>{e.error=void 0,e.isLoading=!0,a.meta.arg.replace&&C.removeAll(e)})).addCase(L.fulfilled,((e,a)=>{e.isLoading=!1,e.hasMore=a.payload.length>0,a.meta.arg.replace?C.setAll(e,a.payload):C.addMany(e,a.payload)})).addCase(L.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload}))}}),{reducer:b,actions:k}=N;var T=t(5893);const I=(0,s.memo)((e=>{const{className:a}=e,{t:t}=(0,d.$)(),s=(0,g.v9)(w.selectAll),r=(0,g.v9)(m),c=(0,g.v9)(P);return(0,g.v9)(y)?(0,T.jsx)(p.xv,{text:t("Ошибка при загрузке статей")}):(0,T.jsx)(u.wD,{isLoading:r,view:c,articles:s,className:a})}));var _=t(6425),q=t(8312),E={sortWrapper:"pyOjonnp",search:"QkNSez8q",tabs:"JHbc4jKB"};const M=(0,s.memo)((e=>{const{className:a}=e,{t:t}=(0,d.$)(),r=(0,i.T)(),l=(0,g.v9)(P),o=(0,g.v9)(x),n=(0,g.v9)(S),p=(0,g.v9)(A),h=(0,g.v9)(j),v=(0,s.useCallback)((()=>{r(L({replace:!0}))}),[r]),m=function(e,a){const t=(0,s.useRef)();return(0,s.useCallback)((function(){for(var a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];t.current&&clearTimeout(t.current),t.current=setTimeout((()=>{e(...s)}),500)}),[e,500])}(v),y=(0,s.useCallback)((e=>{r(k.setView(e))}),[r]),f=(0,s.useCallback)((e=>{r(k.setOrder(e)),r(k.setPage(1)),v()}),[r,v]),C=(0,s.useCallback)((e=>{r(k.setSort(e)),r(k.setPage(1)),v()}),[r,v]),w=(0,s.useCallback)((e=>{r(k.setSearch(e)),r(k.setPage(1)),m()}),[r,m]),N=(0,s.useCallback)((e=>{r(k.setType(e)),r(k.setPage(1)),v()}),[r,v]);return(0,T.jsxs)("div",{className:(0,c.A)(E.ArticlesPageFilters,{},[a]),children:[(0,T.jsxs)("div",{className:E.sortWrapper,children:[(0,T.jsx)(u.xT,{sort:o,order:n,onChangeSort:C,onChangeOrder:f}),(0,T.jsx)(u.Vv,{view:l,onViewClick:y})]}),(0,T.jsx)(_.Z,{className:E.search,children:(0,T.jsx)(q.I,{value:p,onChange:w,placeholder:t("Поиск")})}),(0,T.jsx)(u.XL,{value:h,onChangeType:N,className:E.tabs})]})})),G=(0,h.hg)("ArticlesPage/fetchNextArticlesPage",(async(e,a)=>{const{getState:t,dispatch:s}=a,r=(c=t(),c.articlesPage?.hasMore);var c;const l=f(t()),i=m(t());r&&!i&&(s(k.setPage(l+1)),s(L({})))})),O=(0,h.hg)("ArticlesPage/initArticlesPage",(async(e,a)=>{const{getState:t,dispatch:s}=a;var r;if(r=t(),!r.articlesPage?._inited){const a=e.get("order"),t=e.get("sort"),r=e.get("search"),c=e.get("type");a&&s(k.setOrder(a)),t&&s(k.setSort(t)),r&&s(k.setSearch(r)),c&&s(k.setType(c)),s(k.initState()),s(L({}))}}));const R={articlesPage:b},B=e=>{const{className:a}=e,t=(0,i.T)(),[d]=(0,r.lr)(),g=(0,s.useCallback)((()=>{t(G())}),[t]);return(0,o.Q)((()=>{t(O(d))})),(0,T.jsx)(l.W,{reducers:R,removeAfterUnmount:!1,children:(0,T.jsxs)(n.T,{onScrollEnd:g,className:(0,c.A)("i0h17Gqm",{},[a]),children:[(0,T.jsx)(M,{}),(0,T.jsx)(I,{className:"UsH35LqR"})]})})};B.displayName="ArticlesPage";var F=(0,s.memo)(B)},8312:function(e,a,t){t.d(a,{I:function(){return l}});var s=t(7294),r=t(3007),c=t(5893);const l=(0,s.memo)((e=>{const{className:a,value:t,onChange:l,type:i="text",placeholder:o,autofocus:n,readonly:d,...g}=e,u=(0,s.useRef)(null),[p,h]=(0,s.useState)(!1),[v,m]=(0,s.useState)(0),y=p&&!d;(0,s.useEffect)((()=>{n&&(h(!0),u.current?.focus())}),[n]);const P={fTN1PnWu:d};return(0,c.jsxs)("div",{className:(0,r.A)("LuFDUWoP",P,[a]),children:[o&&(0,c.jsx)("div",{className:"emAQQ85i",children:`${o}>`}),(0,c.jsxs)("div",{className:"y1GiFC_L",children:[(0,c.jsx)("input",{ref:u,type:i,value:t,onChange:e=>{l?.(e.target.value),m(e.target.value.length)},className:"LVdIPwcx",onFocus:()=>{h(!0)},onBlur:()=>{h(!1)},onSelect:e=>{m(e?.target?.selectionStart||0)},readOnly:d,...g}),y&&(0,c.jsx)("span",{className:"lqMFGBuL",style:{left:9*v+"px"}})]})]})}))}}]);